<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCTV Footage Request System</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: var(--dark-color);
        }
        
        .navbar-brand {
            font-weight: 700;
        }
        
        .header {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            margin-bottom: 20px;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
            border-color: #2980b9;
        }
        
        .btn-danger {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
            border-color: #c0392b;
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }
        
        .footer {
            background-color: var(--secondary-color);
            color: white;
            padding: 2rem 0;
            margin-top: 3rem;
        }
        
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-pending {
            background-color: #f39c12;
            color: white;
        }
        
        .status-approved {
            background-color: #2ecc71;
            color: white;
        }
        
        .status-rejected {
            background-color: #e74c3c;
            color: white;
        }
        
        .status-completed {
            background-color: #3498db;
            color: white;
        }
        
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .timeline:before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: var(--primary-color);
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 20px;
        }
        
        .timeline-item:before {
            content: '';
            position: absolute;
            left: -30px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--primary-color);
            border: 2px solid white;
        }

        /* Page Styles */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Admin Panel Styles */
        .admin-badge {
            background-color: #9b59b6;
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        /* Request Cards */
        .request-card {
            transition: all 0.3s ease;
        }

        .request-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        /* CNIC input formatting */
        .cnic-formatted {
            letter-spacing: 1px;
        }

        @media (max-width: 768px) {
            .header {
                padding: 2rem 0;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .form-section {
                padding: 0 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-video me-2"></i>CCTV Request System
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link home-link" href="#" data-page="homePage"><i class="fas fa-home me-1"></i> Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link requests-link" href="#" data-page="myRequestsPage"><i class="fas fa-file-alt me-1"></i> My Requests</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link admin-link" href="#" data-page="adminPage"><i class="fas fa-user-shield me-1"></i> Admin Panel <span class="admin-badge">STAFF</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-question-circle me-1"></i> Help</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-user me-1"></i> Profile</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <div class="container-fluid p-0">
        <!-- Home Page -->
        <div id="homePage" class="page active">
            <!-- Header -->
            <header class="header">
                <div class="container text-center">
                    <h1><i class="fas fa-video me-3"></i>CCTV Footage Request System</h1>
                    <p class="lead">Request access to CCTV footage for security and investigative purposes</p>
                </div>
            </header>

            <!-- Main Content -->
            <div class="container">
                <div class="row">
                    <!-- Request Form -->
                    <div class="col-lg-8">
                        <div class="card mb-4">
                            <div class="card-header">
                                <i class="fas fa-file-alt me-2"></i>New Footage Request
                            </div>
                            <div class="card-body">
                                <form id="requestForm">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="requestorName" class="form-label">Your Name</label>
                                            <input type="text" class="form-control" id="requestorName" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="requestorCnic" class="form-label">CNIC Number</label>
                                            <input type="text" class="form-control cnic-formatted" id="requestorCnic" 
                                                   placeholder="XXXXX-XXXXXXX-X" 
                                                   pattern="\d{5}-\d{7}-\d{1}" 
                                                   title="Please enter CNIC in format: XXXXX-XXXXXXX-X"
                                                   required>
                                            <div class="invalid-feedback">
                                                Please enter a valid CNIC number in format: XXXXX-XXXXXXX-X
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="requestorPhone" class="form-label">Phone Number</label>
                                        <input type="tel" class="form-control" id="requestorPhone" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="incidentDate" class="form-label">Incident Date</label>
                                        <input type="date" class="form-control" id="incidentDate" required>
                                    </div>
                        
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="startTime" class="form-label">Start Time</label>
                                            <input type="time" class="form-control" id="startTime" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="endTime" class="form-label">End Time</label>
                                            <input type="time" class="form-control" id="endTime" required>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="cameraLocation" class="form-label">Camera Location</label>
                                        <select class="form-select" id="cameraLocation" required>
                                            <option value="" selected disabled>Select Camera Location</option>
                                            <option value="Main Entrance">Main Entrance</option>
                                            <option value="Parking Lot">Parking Lot</option>
                                            <option value="Lobby">Lobby</option>
                                            <option value="North Wing">North Wing</option>
                                            <option value="South Wing">South Wing</option>
                                            <option value="East Wing">East Wing</option>
                                            <option value="West Wing">West Wing</option>
                                            <option value="Warehouse">Warehouse</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="purpose" class="form-label">Purpose of Request</label>
                                        <select class="form-select" id="purpose" required>
                                            <option value="" selected disabled>Select Purpose</option>
                                            <option value="Security Incident">Security Incident</option>
                                            <option value="Theft Investigation">Theft Investigation</option>
                                            <option value="Accident Investigation">Accident Investigation</option>
                                            <option value="HR Investigation">HR Investigation</option>
                                            <option value="Operational Review">Operational Review</option>
                                            <option value="Legal Case">Legal Case</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="description" class="form-label">Detailed Description</label>
                                        <textarea class="form-control" id="description" rows="4" required></textarea>
                                        <div class="form-text">Please provide as much detail as possible about why you need this footage.</div>
                                    </div>
                                    
                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="confirmation" required>
                                        <label class="form-check-label" for="confirmation">I confirm that the information provided is accurate and that I have the authority to request this footage.</label>
                                    </div>
                        
                                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                        <button type="reset" class="btn btn-outline-secondary me-md-2">
                                            <i class="fas fa-undo me-1"></i>Reset
                                        </button>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-paper-plane me-1"></i>Submit Request
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sidebar -->
                    <div class="col-lg-4">
                        <!-- Status Card -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <i class="fas fa-info-circle me-2"></i>Request Status
                            </div>
                            <div class="card-body">
                                <div class="timeline">
                                    <div class="timeline-item">
                                        <span class="status-badge status-pending">Pending</span>
                                        <p class="mb-1"><small>Today, 10:30 AM</small></p>
                                        <p>Your request has been submitted and is awaiting review.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Recent Requests -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <i class="fas fa-history me-2"></i>Recent Requests
                            </div>
                            <div class="card-body">
                                <div class="list-group">
                                    <a href="#" class="list-group-item list-group-item-action">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">Parking Lot Incident</h6>
                                            <small class="text-muted">2 days ago</small>
                                        </div>
                                        <p class="mb-1 small">2023-05-15, 14:30 - 15:00</p>
                                        <span class="status-badge status-completed">Completed</span>
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">Lobby Visitor</h6>
                                            <small class="text-muted">1 week ago</small>
                                        </div>
                                        <p class="mb-1 small">2023-05-10, 09:15 - 09:30</p>
                                        <span class="status-badge status-approved">Approved</span>
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">Warehouse Audit</h6>
                                            <small class="text-muted">2 weeks ago</small>
                                        </div>
                                        <p class="mb-1 small">2023-05-02, 08:00 - 17:00</p>
                                        <span class="status-badge status-rejected">Rejected</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Help Card -->
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-question-circle me-2"></i>Need Help?
                            </div>
                            <div class="card-body">
                                <p>If you need assistance with your request, please contact:</p>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-user-shield me-2"></i>Security Department</li>
                                    <li><i class="fas fa-phone me-2"></i>Ext. 5555</li>
                                    <li><i class="fas fa-envelope me-2"></i>security@example.com</li>
                                </ul>
                                <button id="downloadGuidelines" class="btn btn-outline-primary w-100">
                                    <i class="fas fa-file-pdf me-1"></i>Download Guidelines
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- My Requests Page -->
        <div id="myRequestsPage" class="page">
            <!-- Header -->
            <header class="header">
                <div class="container text-center">
                    <h1><i class="fas fa-file-alt me-3"></i>My Requests</h1>
                    <p class="lead">View and manage your CCTV footage requests</p>
                </div>
            </header>

            <!-- Main Content -->
            <div class="container">
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-filter me-2"></i>Filter Requests
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3 mb-3">
                                        <label for="filterStatus" class="form-label">Status</label>
                                        <select class="form-select" id="filterStatus">
                                            <option value="all">All Statuses</option>
                                            <option value="pending">Pending</option>
                                            <option value="approved">Approved</option>
                                            <option value="rejected">Rejected</option>
                                            <option value="completed">Completed</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="filterDateFrom" class="form-label">From Date</label>
                                        <input type="date" class="form-control" id="filterDateFrom">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="filterDateTo" class="form-label">To Date</label>
                                        <input type="date" class="form-control" id="filterDateTo">
                                    </div>
                                    <div class="col-md-3 mb-3 d-flex align-items-end">
                                        <button class="btn btn-primary w-100" id="applyFilters">
                                            <i class="fas fa-filter me-1"></i>Apply Filters
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-list me-2"></i>Your Requests
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Request ID</th>
                                                <th>Date Submitted</th>
                                                <th>Incident Date</th>
                                                <th>Location</th>
                                                <th>Purpose</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="requestsTableBody">
                                            <!-- Requests will be populated here by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Panel Page -->
        <div id="adminPage" class="page">
            <!-- Header -->
            <header class="header">
                <div class="container text-center">
                    <h1><i class="fas fa-user-shield me-3"></i>Admin Panel</h1>
                    <p class="lead">Manage and update CCTV footage requests</p>
                </div>
            </header>

            <!-- Main Content -->
            <div class="container">
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-filter me-2"></i>Filter Requests
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3 mb-3">
                                        <label for="adminFilterStatus" class="form-label">Status</label>
                                        <select class="form-select" id="adminFilterStatus">
                                            <option value="all">All Statuses</option>
                                            <option value="pending">Pending</option>
                                            <option value="approved">Approved</option>
                                            <option value="rejected">Rejected</option>
                                            <option value="completed">Completed</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="adminFilterDateFrom" class="form-label">From Date</label>
                                        <input type="date" class="form-control" id="adminFilterDateFrom">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="adminFilterDateTo" class="form-label">To Date</label>
                                        <input type="date" class="form-control" id="adminFilterDateTo">
                                    </div>
                                    <div class="col-md-3 mb-3 d-flex align-items-end">
                                        <button class="btn btn-primary w-100" id="adminApplyFilters">
                                            <i class="fas fa-filter me-1"></i>Apply Filters
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="fas fa-tasks me-2"></i>Pending Requests
                                </div>
                                <div class="badge bg-primary rounded-pill" id="pendingCount">0</div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Request ID</th>
                                                <th>Requestor</th>
                                                <th>CNIC</th>
                                                <th>Incident Date</th>
                                                <th>Location</th>
                                                <th>Purpose</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="adminRequestsTableBody">
                                            <!-- Requests will be populated here by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5><i class="fas fa-video me-2"></i>CCTV Request System</h5>
                    <p>A secure system for requesting CCTV footage for authorized purposes only.</p>
                </div>
                <div class="col-md-4">
                    <h5>Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-white">Privacy Policy</a></li>
                        <li><a href="#" class="text-white">Terms of Use</a></li>
                        <li><a href="#" class="text-white">Security Guidelines</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Contact</h5>
                    <address>
                        <i class="fas fa-building me-2"></i>Security Department<br>
                        <i class="fas fa-map-marker-alt me-2"></i>123 Corporate Blvd<br>
                        <i class="fas fa-phone me-2"></i>(555) 123-4567
                    </address>
                </div>
            </div>
            <hr class="bg-light">
            <div class="text-center">
                <p class="mb-0">&copy; 2023 CCTV Footage Request System. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sample data for requests
            const sampleRequests = [
                {
                    id: 'REQ-2023-001',
                    dateSubmitted: '2023-05-20',
                    incidentDate: '2023-05-15',
                    location: 'Parking Lot',
                    purpose: 'Theft Investigation',
                    status: 'completed',
                    description: 'Investigation of reported theft from vehicle in parking lot',
                    startTime: '14:30',
                    endTime: '15:00',
                    name: 'John Smith',
                    cnic: '12345-6789012-3',
                    phone: '03001234567'
                },
                {
                    id: 'REQ-2023-002',
                    dateSubmitted: '2023-05-18',
                    incidentDate: '2023-05-10',
                    location: 'Lobby',
                    purpose: 'Visitor Verification',
                    status: 'approved',
                    description: 'Verify identity of visitor who claimed to have appointment',
                    startTime: '09:15',
                    endTime: '09:30',
                    name: 'Sarah Johnson',
                    cnic: '23456-7890123-4',
                    phone: '03111234567'
                },
                {
                    id: 'REQ-2023-003',
                    dateSubmitted: '2023-05-10',
                    incidentDate: '2023-05-02',
                    location: 'Warehouse',
                    purpose: 'Inventory Audit',
                    status: 'rejected',
                    description: 'Cross-check inventory movement with CCTV footage',
                    startTime: '08:00',
                    endTime: '17:00',
                    name: 'Michael Brown',
                    cnic: '34567-8901234-5',
                    phone: '03211234567'
                },
                {
                    id: 'REQ-2023-004',
                    dateSubmitted: new Date().toISOString().split('T')[0],
                    incidentDate: new Date().toISOString().split('T')[0],
                    location: 'Main Entrance',
                    purpose: 'Security Incident',
                    status: 'pending',
                    description: 'Unauthorized access attempt at main entrance',
                    startTime: '10:00',
                    endTime: '10:30',
                    name: 'Emma Wilson',
                    cnic: '45678-9012345-6',
                    phone: '03331234567'
                }
            ];

            // Store requests in localStorage
            if (!localStorage.getItem('cctvRequests')) {
                localStorage.setItem('cctvRequests', JSON.stringify(sampleRequests));
            }

            // Navigation between pages
            const pages = document.querySelectorAll('.page');
            const navLinks = document.querySelectorAll('.nav-link');

            // Show home page by default
            showPage('homePage');

            // Navigation event listeners
            navLinks.forEach(link => {
                if (link.hasAttribute('data-page')) {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        const pageId = this.getAttribute('data-page');
                        showPage(pageId);
                        
                        // Set active nav link
                        navLinks.forEach(l => l.classList.remove('active'));
                        this.classList.add('active');
                    });
                }
            });

            function showPage(pageId) {
                pages.forEach(page => {
                    if (page.id === pageId) {
                        page.classList.add('active');
                        
                        // Load specific page content if needed
                        if (pageId === 'myRequestsPage') {
                            populateRequestsTable();
                        } else if (pageId === 'adminPage') {
                            populateAdminRequestsTable();
                        }
                    } else {
                        page.classList.remove('active');
                    }
                });
            }

            // CNIC input formatting and validation
            const cnicInput = document.getElementById('requestorCnic');
            if (cnicInput) {
                cnicInput.addEventListener('input', function(e) {
                    // Remove all non-digit characters
                    let value = this.value.replace(/\D/g, '');
                    
                    // Format with dashes
                    if (value.length > 5) {
                        value = value.substring(0, 5) + '-' + value.substring(5);
                    }
                    if (value.length > 13) {
                        value = value.substring(0, 13) + '-' + value.substring(13);
                    }
                    
                    // Limit to 15 characters (5+7+1 + 2 dashes)
                    if (value.length > 15) {
                        value = value.substring(0, 15);
                    }
                    
                    this.value = value;
                });
            }

            // Form submission handler
            const requestForm = document.getElementById('requestForm');
            
            if (requestForm) {
                requestForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Validate form
                    if (!requestForm.checkValidity()) {
                        e.stopPropagation();
                        requestForm.classList.add('was-validated');
                        return;
                    }
                    
                    // Validate CNIC format (13 digits with dashes)
                    const cnicValue = document.getElementById('requestorCnic').value;
                    if (!/^\d{5}-\d{7}-\d{1}$/.test(cnicValue)) {
                        document.getElementById('requestorCnic').classList.add('is-invalid');
                        return;
                    } else {
                        document.getElementById('requestorCnic').classList.remove('is-invalid');
                    }
                    
                    // Get form values
                    const formData = {
                        id: 'REQ-' + new Date().getFullYear() + '-' + (Math.floor(Math.random() * 9000) + 1000),
                        dateSubmitted: new Date().toISOString().split('T')[0],
                        name: document.getElementById('requestorName').value,
                        cnic: document.getElementById('requestorCnic').value,
                        phone: document.getElementById('requestorPhone').value,
                        incidentDate: document.getElementById('incidentDate').value,
                        startTime: document.getElementById('startTime').value,
                        endTime: document.getElementById('endTime').value,
                        location: document.getElementById('cameraLocation').value,
                        purpose: document.getElementById('purpose').value,
                        description: document.getElementById('description').value,
                        status: 'pending'
                    };
                    
                    // Save to localStorage
                    const requests = JSON.parse(localStorage.getItem('cctvRequests')) || [];
                    requests.unshift(formData);
                    localStorage.setItem('cctvRequests', JSON.stringify(requests));
                    
                    // Show success message
                    alert('Your CCTV footage request has been submitted successfully. You will receive a confirmation email shortly.');
                    
                    // Reset form
                    requestForm.reset();
                    requestForm.classList.remove('was-validated');
                    
                    // Update the status timeline
                    const timeline = document.querySelector('.timeline');
                    if (timeline) {
                        timeline.innerHTML = `
                            <div class="timeline-item">
                                <span class="status-badge status-pending">Pending</span>
                                <p class="mb-1"><small>Just now</small></p>
                                <p>Your request has been submitted and is awaiting review.</p>
                            </div>
                            ${timeline.innerHTML}
                        `;
                    }
                    
                    // Add to recent requests
                    const recentRequests = document.querySelector('.list-group');
                    if (recentRequests) {
                        const newRequest = document.createElement('a');
                        newRequest.href = '#';
                        newRequest.className = 'list-group-item list-group-item-action';
                        newRequest.innerHTML = `
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">${formData.purpose}</h6>
                                <small class="text-muted">Just now</small>
                            </div>
                            <p class="mb-1 small">${formData.incidentDate}, ${formData.startTime} - ${formData.endTime}</p>
                            <span class="status-badge status-pending">Pending</span>
                        `;
                        
                        recentRequests.insertBefore(newRequest, recentRequests.firstChild);
                    }
                });
            }
            
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            if (document.getElementById('incidentDate')) {
                document.getElementById('incidentDate').value = today;
            }
            
            // Set default time range to current hour
            const now = new Date();
            const currentHour = now.getHours().toString().padStart(2, '0');
            if (document.getElementById('startTime') && document.getElementById('endTime')) {
                document.getElementById('startTime').value = `${currentHour}:00`;
                document.getElementById('endTime').value = `${currentHour}:30`;
            }

            // Populate requests table
            function populateRequestsTable(filterStatus = 'all', dateFrom = null, dateTo = null) {
                const requests = JSON.parse(localStorage.getItem('cctvRequests')) || [];
                const tableBody = document.getElementById('requestsTableBody');
                if (!tableBody) return;
                
                tableBody.innerHTML = '';

                requests.forEach(request => {
                    // Apply filters
                    if (filterStatus !== 'all' && request.status !== filterStatus) return;
                    
                    if (dateFrom && new Date(request.dateSubmitted) < new Date(dateFrom)) return;
                    if (dateTo && new Date(request.dateSubmitted) > new Date(dateTo)) return;

                    const statusClass = getStatusClass(request.status);
                    const statusText = getStatusText(request.status);

                    const row = document.createElement('tr');
                    row.className = 'request-card';
                    row.innerHTML = `
                        <td>${request.id}</td>
                        <td>${request.dateSubmitted}</td>
                        <td>${request.incidentDate}</td>
                        <td>${request.location}</td>
                        <td>${request.purpose}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary view-details" data-id="${request.id}">
                                <i class="fas fa-eye"></i> View
                            </button>
                            ${request.status === 'pending' ? `
                            <button class="btn btn-sm btn-outline-danger delete-request" data-id="${request.id}">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                            ` : ''}
                        </td>
                    `;
                    tableBody.appendChild(row);
                });

                // Add event listeners to view buttons
                document.querySelectorAll('.view-details').forEach(button => {
                    button.addEventListener('click', function() {
                        const requestId = this.getAttribute('data-id');
                        viewRequestDetails(requestId);
                    });
                });

                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-request').forEach(button => {
                    button.addEventListener('click', function() {
                        const requestId = this.getAttribute('data-id');
                        deleteRequest(requestId);
                    });
                });
            }

            // Populate admin requests table
            function populateAdminRequestsTable(filterStatus = 'all', dateFrom = null, dateTo = null) {
                const requests = JSON.parse(localStorage.getItem('cctvRequests')) || [];
                const tableBody = document.getElementById('adminRequestsTableBody');
                if (!tableBody) return;
                
                tableBody.innerHTML = '';

                let pendingCount = 0;

                requests.forEach(request => {
                    // Apply filters
                    if (filterStatus !== 'all' && request.status !== filterStatus) return;
                    
                    if (dateFrom && new Date(request.dateSubmitted) < new Date(dateFrom)) return;
                    if (dateTo && new Date(request.dateSubmitted) > new Date(dateTo)) return;

                    if (request.status === 'pending') pendingCount++;

                    const statusClass = getStatusClass(request.status);
                    const statusText = getStatusText(request.status);

                    const row = document.createElement('tr');
                    row.className = 'request-card';
                    row.innerHTML = `
                        <td>${request.id}</td>
                        <td>${request.name}</td>
                        <td>${request.cnic}</td>
                        <td>${request.incidentDate}</td>
                        <td>${request.location}</td>
                        <td>${request.purpose}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-cog"></i> Actions
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item view-details" href="#" data-id="${request.id}"><i class="fas fa-eye me-2"></i>View Details</a></li>
                                    <li><a class="dropdown-item delete-request" href="#" data-id="${request.id}"><i class="fas fa-trash me-2 text-danger"></i>Delete Request</a></li>
                                    ${request.status === 'pending' ? `
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item change-status" href="#" data-id="${request.id}" data-status="approved"><i class="fas fa-check-circle me-2 text-success"></i>Approve</a></li>
                                    <li><a class="dropdown-item change-status" href="#" data-id="${request.id}" data-status="rejected"><i class="fas fa-times-circle me-2 text-danger"></i>Reject</a></li>
                                    ` : ''}
                                    ${request.status === 'approved' ? `
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item change-status" href="#" data-id="${request.id}" data-status="completed"><i class="fas fa-check-double me-2 text-primary"></i>Mark as Completed</a></li>
                                    ` : ''}
                                </ul>
                            </div>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });

                // Update pending count badge
                document.getElementById('pendingCount').textContent = pendingCount;

                // Add event listeners to view buttons
                document.querySelectorAll('.view-details').forEach(button => {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        const requestId = this.getAttribute('data-id');
                        viewRequestDetails(requestId, true);
                    });
                });

                // Add event listeners to status change buttons
                document.querySelectorAll('.change-status').forEach(button => {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        const requestId = this.getAttribute('data-id');
                        const newStatus = this.getAttribute('data-status');
                        updateRequestStatus(requestId, newStatus);
                    });
                });

                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-request').forEach(button => {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        const requestId = this.getAttribute('data-id');
                        deleteRequest(requestId);
                    });
                });
            }

            function deleteRequest(requestId) {
                if (confirm('Are you sure you want to delete this request? This action cannot be undone.')) {
                    const requests = JSON.parse(localStorage.getItem('cctvRequests')) || [];
                    const updatedRequests = requests.filter(req => req.id !== requestId);
                    localStorage.setItem('cctvRequests', JSON.stringify(updatedRequests));
                    
                    // Show success message
                    alert(`Request ${requestId} has been deleted successfully.`);
                    
                    // Refresh the current table
                    if (document.getElementById('myRequestsPage').classList.contains('active')) {
                        populateRequestsTable(
                            document.getElementById('filterStatus').value,
                            document.getElementById('filterDateFrom').value,
                            document.getElementById('filterDateTo').value
                        );
                    } else if (document.getElementById('adminPage').classList.contains('active')) {
                        populateAdminRequestsTable(
                            document.getElementById('adminFilterStatus').value,
                            document.getElementById('adminFilterDateFrom').value,
                            document.getElementById('adminFilterDateTo').value
                        );
                    }
                }
            }

            function updateRequestStatus(requestId, newStatus) {
                const requests = JSON.parse(localStorage.getItem('cctvRequests')) || [];
                const requestIndex = requests.findIndex(req => req.id === requestId);
                
                if (requestIndex !== -1) {
                    requests[requestIndex].status = newStatus;
                    localStorage.setItem('cctvRequests', JSON.stringify(requests));
                    
                    // Show success message
                    alert(`Request ${requestId} has been updated to "${getStatusText(newStatus)}" status.`);
                    
                    // Refresh the admin table
                    populateAdminRequestsTable(
                        document.getElementById('adminFilterStatus').value,
                        document.getElementById('adminFilterDateFrom').value,
                        document.getElementById('adminFilterDateTo').value
                    );
                    
                    // If we're also on the My Requests page, refresh it too
                    if (document.getElementById('myRequestsPage').classList.contains('active')) {
                        populateRequestsTable(
                            document.getElementById('filterStatus').value,
                            document.getElementById('filterDateFrom').value,
                            document.getElementById('filterDateTo').value
                        );
                    }
                }
            }

            function getStatusClass(status) {
                switch(status) {
                    case 'pending': return 'status-pending';
                    case 'approved': return 'status-approved';
                    case 'rejected': return 'status-rejected';
                    case 'completed': return 'status-completed';
                    default: return '';
                }
            }

            function getStatusText(status) {
                switch(status) {
                    case 'pending': return 'Pending';
                    case 'approved': return 'Approved';
                    case 'rejected': return 'Rejected';
                    case 'completed': return 'Completed';
                    default: return status;
                }
            }

            function viewRequestDetails(requestId, isAdmin = false) {
                const requests = JSON.parse(localStorage.getItem('cctvRequests')) || [];
                const request = requests.find(req => req.id === requestId);
                
                if (request) {
                    const statusClass = getStatusClass(request.status);
                    const statusText = getStatusText(request.status);

                    const modalHtml = `
                        <div class="modal fade" id="requestDetailsModal" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Request Details: ${request.id}</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <h6>Request Information</h6>
                                                <p><strong>Date Submitted:</strong> ${request.dateSubmitted}</p>
                                                <p><strong>Status:</strong> <span class="status-badge ${statusClass}">${statusText}</span></p>
                                                <p><strong>Requestor:</strong> ${request.name}</p>
                                                <p><strong>CNIC:</strong> ${request.cnic}</p>
                                                <p><strong>Phone:</strong> ${request.phone}</p>
                                            </div>
                                            <div class="col-md-6">
                                                <h6>Incident Details</h6>
                                                <p><strong>Incident Date:</strong> ${request.incidentDate}</p>
                                                <p><strong>Time Range:</strong> ${request.startTime} - ${request.endTime}</p>
                                                <p><strong>Location:</strong> ${request.location}</p>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <h6>Purpose</h6>
                                                <p>${request.purpose}</p>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12">
                                                <h6>Description</h6>
                                                <p>${request.description}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        ${isAdmin ? `
                                        <button type="button" class="btn btn-danger delete-request" data-id="${request.id}">
                                            <i class="fas fa-trash"></i> Delete
                                        </button>
                                        ` : ''}
                                        ${isAdmin && request.status === 'pending' ? `
                                        <button type="button" class="btn btn-success change-status" data-id="${request.id}" data-status="approved">
                                            <i class="fas fa-check"></i> Approve
                                        </button>
                                        <button type="button" class="btn btn-danger change-status" data-id="${request.id}" data-status="rejected">
                                            <i class="fas fa-times"></i> Reject
                                        </button>
                                        ` : ''}
                                        ${isAdmin && request.status === 'approved' ? `
                                        <button type="button" class="btn btn-primary change-status" data-id="${request.id}" data-status="completed">
                                            <i class="fas fa-check-double"></i> Mark as Completed
                                        </button>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;

                    // Add modal to DOM
                    const modalContainer = document.createElement('div');
                    modalContainer.innerHTML = modalHtml;
                    document.body.appendChild(modalContainer);

                    // Show modal
                    const modal = new bootstrap.Modal(document.getElementById('requestDetailsModal'));
                    modal.show();

                    // Add event listeners to status change buttons in modal
                    document.querySelectorAll('#requestDetailsModal .change-status').forEach(button => {
                        button.addEventListener('click', function() {
                            const requestId = this.getAttribute('data-id');
                            const newStatus = this.getAttribute('data-status');
                            updateRequestStatus(requestId, newStatus);
                            modal.hide();
                        });
                    });

                    // Add event listener to delete button in modal
                    document.querySelectorAll('#requestDetailsModal .delete-request').forEach(button => {
                        button.addEventListener('click', function() {
                            const requestId = this.getAttribute('data-id');
                            modal.hide();
                            deleteRequest(requestId);
                        });
                    });

                    // Remove modal from DOM after it's hidden
                    document.getElementById('requestDetailsModal').addEventListener('hidden.bs.modal', function() {
                        modalContainer.remove();
                    });
                }
            }

            // Apply filters button (My Requests)
            document.getElementById('applyFilters')?.addEventListener('click', function() {
                const status = document.getElementById('filterStatus').value;
                const dateFrom = document.getElementById('filterDateFrom').value;
                const dateTo = document.getElementById('filterDateTo').value;
                populateRequestsTable(status, dateFrom, dateTo);
            });

            // Apply filters button (Admin)
            document.getElementById('adminApplyFilters')?.addEventListener('click', function() {
                const status = document.getElementById('adminFilterStatus').value;
                const dateFrom = document.getElementById('adminFilterDateFrom').value;
                const dateTo = document.getElementById('adminFilterDateTo').value;
                populateAdminRequestsTable(status, dateFrom, dateTo);
            });

            // Download Guidelines button
            document.getElementById('downloadGuidelines')?.addEventListener('click', function() {
                // Create a PDF content (in a real app, this would be a server-side generated PDF)
                const pdfContent = `
                    %PDF-1.4
                    1 0 obj
                    << /Type /Catalog
                       /Pages 2 0 R
                    >>
                    endobj
                    2 0 obj
                    << /Type /Pages
                       /Kids [3 0 R]
                       /Count 1
                    >>
                    endobj
                    3 0 obj
                    << /Type /Page
                       /Parent 2 0 R
                       /Resources <<
                          /Font <<
                             /F1 4 0 R
                          >>
                       >>
                       /MediaBox [0 0 612 792]
                       /Contents 5 0 R
                    >>
                    endobj
                    4 0 obj
                    << /Type /Font
                       /Subtype /Type1
                       /BaseFont /Helvetica
                    >>
                    endobj
                    5 0 obj
                    << /Length 100 >>
                    stream
                    BT
                    /F1 24 Tf
                    100 700 Td
                    (CCTV Footage Request Guidelines) Tj
                    0 -30 Td
                    (1. All requests must be submitted through this system) Tj
                    0 -30 Td
                    (2. Requests must include valid justification) Tj
                    0 -30 Td
                    (3. Allow 3-5 business days for processing) Tj
                    0 -30 Td
                    (4. Unauthorized access to footage is prohibited) Tj
                    ET
                    endstream
                    endobj
                    xref
                    0 6
                    0000000000 65535 f
                    0000000009 00000 n
                    0000000058 00000 n
                    0000000117 00000 n
                    0000000223 00000 n
                    0000000289 00000 n
                    trailer
                    << /Size 6
                       /Root 1 0 R
                    >>
                    startxref
                    389
                    %%EOF
                `;

                // Create a Blob with the PDF content
                const blob = new Blob([pdfContent], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);

                // Create a temporary anchor element to trigger the download
                const a = document.createElement('a');
                a.href = url;
                a.download = 'CCTV_Request_Guidelines.pdf';
                document.body.appendChild(a);
                a.click();

                // Clean up
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
            });
        });
    </script>
</body>
</html>